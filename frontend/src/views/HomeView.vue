<template>
<div>
    <Announcement></Announcement>
    <Navbar></Navbar>
    <div class="row mx-0 px-1 px-md-5 my-5">
        <div class="col-12 fs-title fw-light text-center mb-4 custom-title-color">
            –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–≤–∏–∞–±–∏–ª–µ—Ç–∞
        </div>
        <div class="col-12 fs-5 text-center fw-light">
            –°–µ—Ä–≤–∏—Å –ø–æ–º–æ–∂–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –≤–∞–º —É–¥–æ–±–Ω—ã–π –º–∞—Ä—à—É—Ç, –∏—Å—Ö–æ–¥—è –∏–∑ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π,<br /> —Å —É—á—ë—Ç–æ–º –≤–∞—à–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.
        </div>
        <div class="position-relative d-flex justify-content-center">
            <ButtonOne class="px-4 py-2 fs-5 rounded-pill position-absolute z-2 mt-4" @click="scrollToSection">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</ButtonOne>
        </div>
        <div class="col-12 position-relative video-container mx-0 px-0" data-aos="fade-up">
            <img class="position-absolute video-overlay" :src="require('@/assets/home-video-head.svg')" alt="Overlay">
            <div class="hero-glass-windows">
                <div class="hero-glass-col opacity-0"></div>
                <div class="hero-glass-col d-none d-md-flex"></div>
                <div class="hero-glass-col d-none d-md-flex"></div>
                <div class="hero-glass-col d-none d-lg-flex"></div>
                <div class="hero-glass-col"></div>
                <div class="hero-glass-col"></div>
                <div class="hero-glass-col opacity-0"></div>
            </div>
            <video autoplay muted loop class="video">
                <source :src="require('@/assets/home-video.mp4')" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    </div>
    <div ref="targetSection" class="row mx-0 px-1 px-md-5 my-5" data-aos="fade-up">
        <div class="col-12 border custom-border-color">
            <div class="row m-0 p-1 p-md-4">
                <div class="col-12 text-center fs-5 fw-light custom-purple-text-color mb-3">–ö–∞–∫–∞—è –±—É–¥–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å?</div>
                <div class="col-12 text-center fs-2 fw-light custom-title-color mb-3">
                    –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ë—ã—Å—Ç—Ä–æ. –¢–æ—á–Ω–æ.
                </div>
                <div class="col-12 fs-6 text-center">
                    <div class="row justify-content-center">
                        <div class="col-12 col-md-8 fw-light">
                            –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–ª–æ–∂–∏—Ç—å—Å—è –≤ –±—é–¥–∂–µ—Ç? –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥—É–º—ã–≤–∞—Ç—å –≤—Å—ë –¥–æ –º–µ–ª–æ—á–µ–π.
                            –î–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ –≤–∞—Å, –∏—Å–ø–æ–ª—å–∑—É—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã.
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 p-4 rounded-3">
                    <div class="mb-3">
                        <label for="from" class="form-label">–û—Ç</label>
                        <select v-model="selectedFrom" id="from" class="form-select red-background">
                            <option v-for="city in cities" :key="city.id" :value="city">
                                {{ city.city }}
                            </option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="to" class="form-label">–ö—É–¥–∞</label>
                        <select v-model="selectedTo" id="to" class="form-select red-background">
                            <option v-for="city in cities" :key="city.id" :value="city">
                                {{ city.city }}
                            </option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="date" class="form-label">–î–∞—Ç–∞</label>
                        <div class="d-flex gap-2">
                            <select v-model="selectedMonth" id="month" class="form-select red-background">
                                <option v-for="(month, index) in months" :key="index" :value="index + 1">
                                    {{ month }}
                                </option>
                            </select>
                            <select v-model="selectedDay" id="day" class="form-select red-background">
                                <option v-for="day in daysInMonth" :key="day" :value="day">
                                    {{ day }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="time" class="form-label">–í—Ä–µ–º—è</label>
                        <input type="time" v-model="selectedTime" id="time" class="form-control red-background" />
                    </div>

                    <div class="mb-3">
                        <label for="ticketType" class="form-label">–¢–∏–ø –±–∏–ª–µ—Ç–∞</label>
                        <select v-model="selectedType" id="ticketType" class="form-select red-background">
                            <option v-for="(tType, index) in ticketType" :key="index" :value="index + 1">
                                {{ tType }}
                            </option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="flightTime" class="form-label">–í—Ä–µ–º—è –Ω–∞ –ø–æ–ª–µ—Ç</label>
                        <input type="time" v-model="selectedFlightTime" id="flightTime" class="form-control red-background" />
                    </div>
                    <div class="mb-4">
                        <label for="numTransfers" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–∞–¥–æ–∫</label>
                        <select v-model="selectedNumTransfers" id="numTransfers" class="form-select red-background">
                            <option v-for="(tType, index) in numTransfers" :key="index" :value="index + 1">
                                {{ tType }}
                            </option>
                        </select>
                    </div>
                    <div class="d-flex">
                        <ButtonOne class="px-4 py-2 fs-5 rounded-pill" @click="calc">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</ButtonOne>
                    </div>
                </div>
                <div v-if="isCalcLoading"  class="col-12 col-md-6 p-4 rounded-3 pt-5">
                    <div class="row justify-content-center mx-0 mb-4">
                        <div class="spinner-border" style="color: var(--custom-purple-color);" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
                <div v-else-if="!isCalcLoading && isCalced" class="col-12 col-md-6 p-4 rounded-3 pt-5">
                    <div class="row mb-3">
                        <div class="col-12 text-center fs-5 fw-light">
                            –ù–µ–π—Ä–æ—Å–µ—Ç—å ü§ñ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞ –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—É—é —Ü–µ–Ω—É
                        </div>
                    </div>
                    <div class="row" v-if="calcResults.length > 0">
                        <div class="col-12" v-for="calcResult in calcResults" :key="calcResult.id">
                            <div class="row fw-light mb-3 fs-5">
                                <div class="col-12 d-flex gap-2 mb-2">
                                    <div class="fs-4 d-flex align-items-center gap-2">
                                        <img style="width: 30px;" :src="require('@/assets/company.svg')">
                                        <div>{{ calcResult.title }}</div>
                                    </div>
                                </div>
                                <div class="col-12 d-flex gap-2">
                                    <div>–¶–µ–Ω–∞: </div>
                                    <div class="fw-normal">{{ calcResult.price }} ‚ÇΩ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else class="fw-light text-center">
                        –î–∞–Ω–Ω—ã–π –ø–µ—Ä–µ–ª–µ—Ç –Ω–µ –≤–æ–∑–º–æ–∂–µ–Ω ):
                    </div>
                </div>
                <div v-else class="col-12 col-md-6 p-4 rounded-3 pt-5">
                    
                </div>
            </div>
        </div>
    </div>
    <div class="row mx-0 px-1 px-md-5 my-5" data-aos="fade-up">
        <div class="col-12 px-0">
            <div class="row m-0">
                <div class="col-12 text-center fs-5 fw-light custom-purple-text-color mb-3">–ö—É–¥–∞ –º–æ–∂–Ω–æ —Å—Ö–æ–¥–∏—Ç—å?</div>
                <div class="col-12 text-center fs-2 fw-light custom-title-color mb-3">
                    –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                </div>
                <div class="col-12 fs-6 text-center mb-5">
                    <div class="row justify-content-center">
                        <div class="col-12 col-md-8 fw-light">
                            –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∏ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç –≤–∞–º —Å–ø–∏—Å–æ–∫ –∑–Ω–∞—á–∏–º—ã—Ö –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç –¥–ª—è –æ—Ç–¥—ã—Ö–∞.
                        </div>
                    </div>
                </div>
                <div class="mx-0 px-0">
                    <PlaceElementList :elements="places"></PlaceElementList>
                    <div class="col-12 d-flex justify-content-center">
                        <ButtonOne class="px-4 py-2 fs-5 rounded-pill">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ</ButtonOne>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mx-0 px-1 px-md-5 py-5 custom-purple-background-color custom-light-text-color">
        <div class="col-12 fs-5 px-0 mb-5 text-center">
            –ù–µ –∑–Ω–∞–µ—Ç–µ –∫—É–¥–∞ –ø–æ–ª–µ—Ç–µ—Ç—å?
        </div>
        <div class="col-12">
            <div class="row justify-content-center">
                <div class="col-10 border custom-border-color py-3 py-md-5 px-3 px-md-5">
                    <div class="row">
                        <div class="col-12 col-md-6 fs-1">
                            –¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö<br />
                            –º–µ—Å—Ç –¥–ª—è <br />
                            –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="row h-100">
                                <div class="col-12 fs-5 mb-3 d-flex align-self-end fw-light">
                                    –ú–µ—Å—Ç–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –ª—é–¥—å–º–∏
                                </div>
                                <div class="col-12">
                                    <ButtonOne class="px-4 py-2 fs-5 rounded-pill text-nowrap" @click="goToPage">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</ButtonOne>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <Footer></Footer>
</div>
</template>

<script>
import axiosApiInstanceAuth from '../api';
import PlaceElementList from "@/components/PlaceElementList";

export default {
    components: {
        PlaceElementList
    },
    data() {
        return {
            isCalced: false,
            isCalcLoading: false,
            places: [],
            cities: [],
            numTransfers: [1, 2, 3],
            ticketType: ['economy', 'business'],
            selectedFrom: null,
            selectedTo: null,
            selectedMonth: 1, // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –Ø–Ω–≤–∞—Ä—å
            selectedType: 1, // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: economy
            selectedDay: 1, // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1-–π –¥–µ–Ω—å
            selectedTime: '00:00', // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–æ–ª–Ω–æ—á—å
            selectedFlightTime: '01:00', // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 —á–∞—Å
            selectedNumTransfers: 1, // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 –ø–µ—Ä–µ—Å–∞–¥–∫–∞
            calcResults: [],
            months: [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ]
        };
    },
    methods: {
        scrollToSection() {
            this.$refs.targetSection.scrollIntoView({ behavior: 'smooth' });
        },
        async calc() {
            this.isCalcLoading = true;
            console.log(this.selectedTo);
            try {
                const flightTimeParts = this.selectedFlightTime.split(':');
                const formattedFlightTime = `${flightTimeParts[0]}h ${flightTimeParts[1]}m`;
                const response = await axiosApiInstanceAuth.post(`http://127.0.0.1:8000/api/directions/price/`, {
                    from: this.selectedFrom.id,
                    to: this.selectedTo.id,
                    date: this.selectedMonth.toString().padStart(2, '0') + '-' + this.selectedDay.toString().padStart(2, '0'),
                    dep_time: this.selectedTime,
                    clas: this.selectedType,
                    stop: this.selectedNumTransfers,
                    time_taken: formattedFlightTime
                });

                const responseData = response.data;
                console.log(responseData);

                if (responseData && responseData.result && Array.isArray(responseData.result)) {
                    this.calcResults = responseData.result.map((place) => ({
                        title: place[0],
                        price: parseFloat(place[1]).toFixed(2)
                    }));
                    this.isCalcLoading = false;
                    this.isCalced = true;
                } else {
                    console.error('Invalid response format');
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
            try {
                const response = await axiosApiInstanceAuth.get(`http://127.0.0.1:8000/api/directions/${this.selectedTo.id}/places/`);
                const cityData = response.data;
                console.log(cityData);
                this.places = response.data.map((place) => ({
                    id: place.id,
                    title: place.title,
                    photo: place.photo,
                    description: place.description
                }));
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        },
        goToPage(id) {
            this.$router.push({ name: 'popular' });
        },
        async fetchCities() {
            try {
                const response = await axiosApiInstanceAuth.get(`http://127.0.0.1:8000/api/directions/list/`);
                const cityData = response.data;
                console.log(cityData);
                this.cities = response.data.map((city) => ({
                    id: city.id,
                    city: city.city
                }));

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤
                if (this.cities.length > 0) {
                    this.selectedFrom = this.cities[0];
                    this.selectedTo = this.cities[1] || this.cities[0];
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }
    },
    created() {
        this.fetchCities();
    },
    computed: {
        daysInMonth() {
            if (this.selectedMonth === null) {
                return [];
            }
            const days = new Date(2024, this.selectedMonth, 0).getDate(); // 2024 - –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–µ–≤—Ä–∞–ª—è
            return Array.from({ length: days }, (_, i) => i + 1);
        },
        formattedDate() {
            if (this.selectedMonth && this.selectedDay) {
                return `${String(this.selectedDay).padStart(2, '0')}-${String(this.selectedMonth).padStart(2, '0')}`;
            }
            return '';
        }
    }
};
</script>

<style scoped>
.form-label,
.form-select {}

.form-select.red-background,
.form-control.red-background {
    background-color: var(--custom-light-background-color) !important;
}

.hero-glass-col {
    background: var(--custom-light-background-color) !important;
    width: 34px;
    height: 100%;
}

.hero-glass-windows {
    justify-content: space-between;
    display: flex;
    position: absolute;
    top: 0%;
    bottom: 0%;
    left: 0%;
    right: 0%;
}

.video-container {
    width: 100%;
    overflow: hidden;
}

.video {
    width: 100%;
    height: auto;
}

.video-overlay {
    top: 0;
    left: -10px;
    width: calc(100% + 20px);
    height: auto;
}
</style>
